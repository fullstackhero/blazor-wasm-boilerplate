@page "/roles/{Id}/permissions"
@attribute [Authorize(Policy = FSHPermissions.Roles.View)]
@inject IStringLocalizer<RolePermissions> _localizer

<FshTitle Title="@_title" Description="@_description" />

@if (!_loaded)
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
}
else
{
     <MudTabs Elevation="25" Rounded="true" Centered="true" ApplyEffectsToContainer="true" AlwaysShowScrollButtons="true">
        @foreach (var group in GroupedRoleClaims.Keys)
        {
            var selectedRoleClaimsInGroup = GroupedRoleClaims[group].Where(c => c.Enabled).ToList();
            var allRoleClaimsInGroup = GroupedRoleClaims[group].ToList();
            <MudTabPanel Text="@group" BadgeData="@($"{selectedRoleClaimsInGroup.Count}/{allRoleClaimsInGroup.Count}")" Style="padding-right: 43px;" BadgeColor="@GetGroupBadgeColor(selectedRoleClaimsInGroup.Count, allRoleClaimsInGroup.Count)">
                    <MudTable Hover="true" Elevation="25" Items="@allRoleClaimsInGroup" Style="margin-bottom:0px!important" Filter="new Func<PermissionUpdateDto, bool>(Search)">
        <ToolBarContent>
            <div class="justify-center mud-text-align-center">
                <MudButton Variant="Variant.Filled" Color="Color.Info" Class="ml-auto" StartIcon="@Icons.Material.Filled.ArrowBack" Link="/roles">@_localizer["Back"]
                </MudButton>
                @if (_canEditRoleClaims)
            {
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="SaveAsync"
                ButtonType="ButtonType.Submit" Style="margin-left: 5px!important;" StartIcon="@Icons.Material.Filled.Save">@_localizer["Update Permissions"]
                </MudButton>
            }
        </div>
        <MudSpacer />
        @if (_canSearchRoleClaims)
        {
            <MudTextField @bind-Value="_searchString" Immediate="true" FullWidth=false
            Placeholder="@_localizer["Search For Role Permissions"]" Adornment="Adornment.End"
            AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0 mb-3"></MudTextField>
        }
    </ToolBarContent>
    <HeaderContent>
        <MudTh>
            <MudTableSortLabel SortBy="new Func<PermissionUpdateDto, object?>(x => x.Permission)">
                @_localizer["Permission Name"]</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortBy="new Func<PermissionUpdateDto, object?>(x => x.Description)">
                @_localizer["Description"]</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortBy="new Func<PermissionUpdateDto, object>(x => x.Enabled)">@_localizer["Status"]
            </MudTableSortLabel>
        </MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="@_localizer["Permission Name"]">
            <MudHighlighter Text="@context.Permission" HighlightedText="@_searchString" />
        </MudTd>
        <MudTd DataLabel="@_localizer["Description"]">
            <MudHighlighter Text="@context.Description" HighlightedText="@_searchString" />
        </MudTd>
        <MudTd DataLabel="Permission">
            <MudCheckBox @bind-Checked="@context.Enabled" Disabled="@(!_canEditRoleClaims)" Color="Color.Secondary">
            </MudCheckBox>
        </MudTd>
    </RowTemplate>
    <PagerContent>
        <TablePager />
    </PagerContent>
</MudTable>
            </MudTabPanel>
        }
        </MudTabs>

}